"use strict";(()=>{var E,L=!1;function y(){document.getElementById("uv-frame").addEventListener("load",()=>{L=!0,navbar.classList.add("hidden")}),notch.addEventListener("mouseenter",()=>{L&&(navbar.classList.remove("hidden"),notch.classList.add("no-pointer-events"))}),navbar.addEventListener("mouseenter",()=>{clearTimeout(E)}),navbar.addEventListener("mouseleave",n);function n(){clearTimeout(E),E=setTimeout(()=>{L&&navbar.classList.add("hidden"),notch.classList.remove("no-pointer-events")},500)}document.addEventListener("touchstart",t=>{t.touches[0].clientY<navbar.offsetHeight&&L&&navbar.classList.remove("hidden")})}var j="/uv/sw.js",A=["localhost","127.0.0.1"];async function _(){if(!navigator.serviceWorker)throw location.protocol!=="https:"&&!A.includes(location.hostname)?new Error("Service workers cannot be registered without https."):new Error("Your browser doesn't support service workers.");await navigator.serviceWorker.register(j)}function x(e,n,t){let r,o=!1;function a(){o||(o=!0,clearTimeout(r),n.call(this))}function i(){this.readyState==="complete"&&a.call(this)}e.addEventListener("load",function(){a.call(e.contentDocument)});function u(){let d=e.contentDocument;if(d.URL.indexOf("about:")!==0){if(d.readyState==="complete")a.call(d);else if(d.addEventListener("DOMContentLoaded",a),d.addEventListener("readystatechange",i),t){let p=d.defaultView.PerformanceObserver;new p(function(M){M.getEntries().length>0&&a.call(d)}).observe({type:"paint"})}}else r=setTimeout(u,1)}u()}function I(e,n){try{return{url:new URL(e).toString(),was_search:!1}}catch{}try{let t=new URL(`http://${e}`);if(t.hostname.includes("."))return{url:t.toString(),was_search:!1}}catch{}return{url:n.replace("%s",encodeURIComponent(e)),was_search:!0}}var g=document.getElementById("uv-form"),l=document.getElementById("uv-address"),F=document.getElementById("uv-search-engine"),N=document.getElementById("uv-error"),Y=document.getElementById("uv-error-code"),B=new BareMux.BareMuxConnection("/baremux/worker.js"),D=document.getElementById("loader"),s=document.getElementById("uv-frame"),J=document.getElementById("navbar"),P=document.getElementById("notch"),V=document.getElementById("settings"),X=document.getElementById("reload"),q=document.getElementById("back"),z=document.getElementById("forward"),v=document.getElementById("proxied-content-wrapper"),T=document.getElementById("omnibox-wrapper"),f=document.getElementById("bookmarks-wrapper"),m=document.getElementById("bookmark-star"),h=document.getElementById("filled-star"),S=!0,R="bookmark_whirlwind_",c;m.addEventListener("click",function(){let e=w(s.contentWindow.location.href),n=ee(s.contentDocument),t=URL.parse(n,e);n===null&&(t=URL.parse(e).origin+"/favicon.ico");let r={favicon_url:t,name:s.contentDocument.title,url:e};c.push(r),k(window.localStorage,c),m.classList.add("none"),h.classList.remove("none")});h.addEventListener("click",function(){let e=[];for(let n of c)n.url==w(s.contentWindow.location.href)&&e.push(n);for(let n of e){let t;(t=c.indexOf(n))!==-1&&c.splice(t,1)}k(window.localStorage,c),m.classList.remove("none"),h.classList.add("none")});g.addEventListener("submit",b);X.addEventListener("click",function(){b(null,w(s.contentDocument.location.href))});q.addEventListener("click",function(){s.contentWindow.history.back()});z.addEventListener("click",function(){s.contentWindow.history.forward()});var C=s.contentDocument.location.href,me=setInterval(function(){if(C!=s.contentDocument.location.href){l.value=w(s.contentDocument.location.href);let e=!1;for(let n of c)e=e||n.url==l.value;e?(m.classList.add("none"),h.classList.remove("none")):(h.classList.add("none"),m.classList.remove("none")),C=s.contentDocument.location.href,s.contentDocument.addEventListener("dragover",function(n){n.preventDefault()}),s.contentDocument.addEventListener("drop",function(n){n.preventDefault(),b(null,n.dataTransfer.getData("text/plain"))})}},50);async function b(e,n){(e??!1)&&e.preventDefault();let t=g.dataset.isSearchBar==="true";try{await _()}catch(a){throw N.textContent="Failed to register service worker.",Y.textContent=a.toString(),a}let r=n??I(l.value,F.value).url,o=(location.protocol==="https:"?"wss":"ws")+"://"+location.host+"/wisp/";await B.getTransport()!=="/epoxy/index.mjs"&&await B.setTransport("/epoxy/index.mjs",[{wisp:o}]),t&&G(),s.src=$(r),D.classList.contains("none")||x(s,()=>{s.classList.add("loaded-frame"),D.classList.add("none")},!0)}function G(){v.classList.replace("none","fullscreen"),T.appendChild(g),g.classList.add("omnibox"),g.dataset.isSearchBar="false",P.classList.add("none"),J.classList.add("none"),T.appendChild(V);let e=window.localStorage,n=e.getItem("bookmarksEnabled");n==="true"?v.classList.add("with-bookmarks"):n==="false"?v.classList.remove("with-bookmarks"):(e.setItem("bookmarksEnabled",S),S?v.classList.add("with-bookmarks"):v.classList.remove("with-bookmarks")),k(e),m.classList.remove("none")}l.addEventListener("drop",function(e){e.preventDefault(),l.value=e.dataTransfer.getData("text/plain")});l.addEventListener("dragenter",function(e){e.preventDefault(),l.select()});l.addEventListener("dragleave",function(e){e.preventDefault(),document.getSelection().removeAllRanges()});function U(e){return`<span class="bookmark-divider vhidden" id="divider_${e}"><svg id="chart" width="0.25rem" height="2rem"><line x1="0" y1="0" x2="0" y2="32" class="vertical-bar"></line></svg></span>`}function k(e,n){e.getItem("bookmarks")===null&&e.setItem("bookmarks","[]"),(n??!1)&&e.setItem("bookmarks",JSON.stringify(n)),c=JSON.parse(e.getItem("bookmarks")),f.innerHTML=U(0);for(let[t,r]of oe(c)){let o=document.createElement("span");o.classList.add("bookmark"),o.draggable=!0;let a=document.createElement("img");a.alt="bookmark favicon",a.classList.add("bookmark-favicon"),a.classList.add("bookmark-favicon-waiting"),a.draggable=!1,o.appendChild(a),o.insertAdjacentText("beforeend",r.name),o.dataset.url=r.url,o.id=`${R}${t}`,o.addEventListener("dragstart",function(i){i.currentTarget.classList.add("dragging"),i.dataTransfer.clearData(),i.dataTransfer.setData("text/plain",i.target.dataset.url),i.dataTransfer.setData("text/id",i.target.id),i.dataTransfer.setData(`text/whirlwind_bookmark_id__${i.target.id}`,"")}),o.addEventListener("dragend",function(i){i.currentTarget.classList.remove("dragging")}),ne(r,a,o),f.appendChild(o),f.insertAdjacentHTML("beforeend",U(t+1)),o.onclick=()=>b(null,o.dataset.url)}f.addEventListener("dragover",function(t){t.preventDefault(),W(t,function(r,o,a){O(o,t,r,()=>r.classList.remove("vhidden"))})}),f.addEventListener("dragleave",function(t){for(let r of document.getElementsByClassName("bookmark-divider"))r.classList.add("vhidden")}),f.addEventListener("drop",function(t){W(t,function(r,o){O(o,t,r,function(a,i,u){let d=parseInt(u.id.substring(R.length));K(c,d,parseInt(i.id.substring(8))),k(window.localStorage,c)})})})}function K(e,n,t){return n<t&&(t-=1),e.splice(t,0,e.splice(n,1)[0]),e}function O(e,n,t,r){if(e<Math.hypot(n.target.clientWidth,n.target.clientHeight)){let o=null;for(let a of n.dataTransfer.types)a.startsWith("text/whirlwind_bookmark_id__")&&(o=document.getElementById(a.substring(28)));o.previousElementSibling.id==t.id||o.nextElementSibling.id==t.id||r(n,t,o)}}function W(e,n){let t=null,r=1/0,o=null;for(let a of document.getElementsByClassName("bookmark-divider")){a.classList.add("vhidden");let i=a.getBoundingClientRect(),u=(i.left+i.right)/2,d=(i.top+i.bottom)/2,p=Math.hypot(e.clientX-u,e.clientY-d);p<r&&(r=p,t=a,o=i)}t!==null&&n(t,r,o)}function $(e){return __uv$config.prefix+__uv$config.encodeUrl(e)}function w(e){return __uv$config.decodeUrl(e.split(__uv$config.prefix)[1])}function Q(e,n,t,r){try{let o=e.contentDocument.getElementsByTagName("img")[0],a=document.createElement("canvas");a.width=o.naturalWidth,a.height=o.naturalHeight,a.getContext("2d").drawImage(o,0,0),a.toBlob(function(i){i!==null&&(Z(r,i),H(URL.createObjectURL(i),n,t),window.addEventListener("beforeunload",function(){URL.revokeObjectURL(i)})),e.remove()})}catch(o){console.warn("failed to load favicon (cross platform issue?)"),console.log(o)}}function Z(e,n){te(n).then(t=>{window.localStorage.setItem(`favicon_cache__${e.favicon_url}`,t)})}function ee(e){let n=null,t=e.getElementsByTagName("link");for(let r of t)(r.getAttribute("rel")=="icon"||r.getAttribute("rel")=="shortcut icon")&&(n=r.getAttribute("href"));return n}function te(e){return new Promise((n,t)=>{let r=new FileReader;r.onloadend=()=>n(r.result),r.readAsDataURL(e)})}function ne(e,n,t){let r=window.localStorage.getItem(`favicon_cache__${e.favicon_url}`);if(r??!1){fetch(r).then(a=>a.blob()).then(a=>{H(URL.createObjectURL(a),n,t),window.addEventListener("beforeunload",function(){URL.revokeObjectURL(a)})});return}let o=document.createElement("iframe");o.src=$(e.favicon_url),o.onload=()=>Q(o,n,t,e),document.getElementById("favicon-loaders").appendChild(o)}function H(e,n,t){n.src=e,n.classList.remove("bookmark-favicon-waiting"),t.removeChild(t.firstChild),t.insertBefore(n,t.firstChild),document.getElementById(t.id).innerHTML=t.innerHTML}function*oe(e,n=0){let t=n;for(let r of e)yield[t++,r]}y();})();
//# sourceMappingURL=index.min.js.map
