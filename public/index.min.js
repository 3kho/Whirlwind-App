"use strict";(()=>{var _,k=!1;function I(){document.getElementById("uv-frame").addEventListener("load",()=>{k=!0,navbar.classList.add("hidden")}),notch.addEventListener("mouseenter",()=>{k&&(navbar.classList.remove("hidden"),notch.classList.add("no-pointer-events"))}),navbar.addEventListener("mouseenter",()=>{clearTimeout(_)}),navbar.addEventListener("mouseleave",t);function t(){clearTimeout(_),_=setTimeout(()=>{k&&navbar.classList.add("hidden"),notch.classList.remove("no-pointer-events")},500)}document.addEventListener("touchstart",n=>{n.touches[0].clientY<navbar.offsetHeight&&k&&navbar.classList.remove("hidden")})}var N="/uv/sw.js",G=["localhost","127.0.0.1"];async function x(){if(!navigator.serviceWorker)throw location.protocol!=="https:"&&!G.includes(location.hostname)?new Error("Service workers cannot be registered without https."):new Error("Your browser doesn't support service workers.");await navigator.serviceWorker.register(N)}function C(e,t,n){let o,i=!1;function a(){i||(i=!0,clearTimeout(o),t.call(this))}function r(){this.readyState==="complete"&&a.call(this)}e.addEventListener("load",function(){a.call(e.contentDocument)});function m(){let l=e.contentDocument;if(l.URL.indexOf("about:")!==0){if(l.readyState==="complete")a.call(l);else if(l.addEventListener("DOMContentLoaded",a),l.addEventListener("readystatechange",r),n){let s=l.defaultView.PerformanceObserver;new s(function(y){y.getEntries().length>0&&a.call(l)}).observe({type:"paint"})}}else o=setTimeout(m,1)}m()}function D(e,t){try{return{url:new URL(e).toString(),was_search:!1}}catch{}try{let n=new URL(`http://${e}`);if(n.hostname.includes("."))return{url:n.toString(),was_search:!1}}catch{}return{url:t.replace("%s",encodeURIComponent(e)),was_search:!0}}function B(){let e=new Date,t=e.getHours(),n=e.getMinutes(),o=e.getSeconds(),i="AM";t==0&&(t=12),t>12&&(t=t-12,i="PM"),t=t<10?"0"+t:t,n=n<10?"0"+n:n,o=o<10?"0"+o:o;let a=t+":"+n+":"+o+" "+i;document.getElementById("clockDisplay").innerText=a,document.getElementById("clockDisplay").textContent=a,setTimeout(B,1e3)}function T(){document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("tabButton"),t=document.getElementById("themeButton"),n=document.getElementById("dropdownContent"),o=document.getElementById("dropdownContent2"),i=document.getElementById("dropdownColorContent"),a=[{title:"Google Classroom",favicon:"https://ssl.gstatic.com/classroom/favicon.png"},{title:"Google Drive",favicon:"https://ssl.gstatic.com/docs/doclist/images/drive_2022q3_32dp.png"},{title:"Google Docs",favicon:"https://ssl.gstatic.com/docs/doclist/images/drive_2022q3_32dp.png"},{title:"Google",favicon:"https://www.google.com/favicon.ico"}],r=[{title:"Original",colorCode:"#102a43"},{title:"Frapp\xE9",colorCode:"#303446"},{title:"Macchiato",colorCode:"#24273a"},{title:"Mocha",colorCode:"#1e1e2e"},{title:"Red",colorCode:"#d46a6c"},{title:"Yellow",colorCode:"#e9c377"},{title:"Green",colorCode:"#89a35f"},{title:"Purple",colorCode:"#755f91"},{title:"Pink",colorCode:"#a64d99"},{title:"OLED",colorCode:"#000000"},{title:"Dark",colorCode:"#31363F"}];a.forEach(s=>{let d=document.createElement("a");d.href="#",d.innerHTML=`<img src="${s.favicon}" alt="${s.title}"> ${s.title}`,d.addEventListener("click",function(){m(s.title,s.favicon)}),o.appendChild(d)}),e.addEventListener("click",function(){o.style.display=o.style.display==="block"?"none":"block"}),t.addEventListener("click",function(){i.style.display=i.style.display==="block"?"none":"block"});function m(s,d){document.title=s;let y=document.getElementById("favicon");y.href=d}function l(s,d){console.log("fired"),document.body.style.background=d}r.forEach(s=>{let d=document.createElement("a");d.href="#",d.innerHTML=`${s.title}`,d.addEventListener("click",function(){l(s.title,s.colorCode)}),i.appendChild(d)})})}function S(){document.getElementById("openPopup").addEventListener("click",function(){document.getElementById("popup").classList.add("show")}),document.getElementById("closePopup").addEventListener("click",function(){let e=document.getElementById("popup");e.style.opacity="0",setTimeout(()=>{e.classList.remove("show"),e.style.opacity=""},300)})}var h=document.getElementById("uv-form"),f=document.getElementById("uv-address"),Y=document.getElementById("uv-search-engine"),q=document.getElementById("uv-error"),J=document.getElementById("uv-error-code"),R=new BareMux.BareMuxConnection("/baremux/worker.js"),U=document.getElementById("loader"),c=document.getElementById("uv-frame"),V=document.getElementById("navbar"),X=document.getElementById("notch"),z=document.getElementById("settings"),K=document.getElementById("reload"),Q=document.getElementById("back"),Z=document.getElementById("forward"),p=document.getElementById("proxied-content-wrapper"),M=document.getElementById("omnibox-wrapper"),v=document.getElementById("bookmarks-wrapper"),g=document.getElementById("bookmark-star"),L=document.getElementById("filled-star"),O=!0,$="bookmark_whirlwind_",u;g.addEventListener("click",function(){let e=E(c.contentWindow.location.href),t=ie(c.contentDocument),n=URL.parse(t,e);t===null&&(n=URL.parse(e).origin+"/favicon.ico");let o={favicon_url:n,name:c.contentDocument.title,url:e};u.push(o),b(window.localStorage,u),g.classList.add("none"),L.classList.remove("none")});L.addEventListener("click",function(){let e=[];for(let t of u)t.url==E(c.contentWindow.location.href)&&e.push(t);for(let t of e){let n;(n=u.indexOf(t))!==-1&&u.splice(n,1)}b(window.localStorage,u),g.classList.remove("none"),L.classList.add("none")});h.addEventListener("submit",w);K.addEventListener("click",function(){w(null,E(c.contentDocument.location.href))});Q.addEventListener("click",function(){c.contentWindow.history.back()});Z.addEventListener("click",function(){c.contentWindow.history.forward()});var H=c.contentDocument.location.href,Ee=setInterval(function(){if(H!=c.contentDocument.location.href){f.value=E(c.contentDocument.location.href);let e=!1;for(let t of u)e=e||t.url==f.value;e?(g.classList.add("none"),L.classList.remove("none")):(L.classList.add("none"),g.classList.remove("none")),H=c.contentDocument.location.href,c.contentDocument.addEventListener("dragover",function(t){t.preventDefault()}),c.contentDocument.addEventListener("drop",function(t){t.preventDefault(),w(null,t.dataTransfer.getData("text/plain"))})}},50);async function w(e,t){(e??!1)&&e.preventDefault();let n=h.dataset.isSearchBar==="true";try{await x()}catch(a){throw q.textContent="Failed to register service worker.",J.textContent=a.toString(),a}let o=t??D(f.value,Y.value).url,i=(location.protocol==="https:"?"wss":"ws")+"://"+location.host+"/wisp/";await R.getTransport()!=="/epoxy/index.mjs"&&await R.setTransport("/epoxy/index.mjs",[{wisp:i}]),n&&ee(),c.src=F(o),U.classList.contains("none")||C(c,()=>{c.classList.add("loaded-frame"),U.classList.add("none")},!0)}function ee(){p.classList.replace("none","fullscreen"),M.appendChild(h),h.classList.add("omnibox"),h.dataset.isSearchBar="false",X.classList.add("none"),V.classList.add("none"),M.appendChild(z);let e=window.localStorage,t=e.getItem("bookmarksEnabled");t==="true"?p.classList.add("with-bookmarks"):t==="false"?p.classList.remove("with-bookmarks"):(e.setItem("bookmarksEnabled",O),O?p.classList.add("with-bookmarks"):p.classList.remove("with-bookmarks")),b(e),g.classList.remove("none")}f.addEventListener("drop",function(e){e.preventDefault(),f.value=e.dataTransfer.getData("text/plain")});f.addEventListener("dragenter",function(e){e.preventDefault(),f.select()});f.addEventListener("dragleave",function(e){e.preventDefault(),document.getSelection().removeAllRanges()});function W(e){return`<span class="bookmark-divider vhidden" id="divider_${e}"><svg id="chart" width="0.25rem" height="2rem"><line x1="0" y1="0" x2="0" y2="32" class="vertical-bar"></line></svg></span>`}function b(e,t){e.getItem("bookmarks")===null&&e.setItem("bookmarks","[]"),(t??!1)&&e.setItem("bookmarks",JSON.stringify(t)),u=JSON.parse(e.getItem("bookmarks")),v.innerHTML=W(0);for(let[n,o]of se(u)){let i=document.createElement("span");i.classList.add("bookmark"),i.draggable=!0;let a=document.createElement("img");a.alt="bookmark favicon",a.classList.add("bookmark-favicon"),a.classList.add("bookmark-favicon-waiting"),a.draggable=!1,i.appendChild(a),i.insertAdjacentText("beforeend",o.name),i.dataset.url=o.url,i.id=`${$}${n}`,i.addEventListener("dragstart",function(r){r.currentTarget.classList.add("dragging"),r.dataTransfer.clearData(),r.dataTransfer.setData("text/plain",r.target.dataset.url),r.dataTransfer.setData("text/id",r.target.id),r.dataTransfer.setData(`text/whirlwind_bookmark_id__${r.target.id}`,"")}),i.addEventListener("dragend",function(r){r.currentTarget.classList.remove("dragging")}),re(o,a,i),v.appendChild(i),v.insertAdjacentHTML("beforeend",W(n+1)),i.onclick=()=>w(null,i.dataset.url)}v.addEventListener("dragover",function(n){n.preventDefault(),A(n,function(o,i,a){j(i,n,o,()=>o.classList.remove("vhidden"))})}),v.addEventListener("dragleave",function(n){for(let o of document.getElementsByClassName("bookmark-divider"))o.classList.add("vhidden")}),v.addEventListener("drop",function(n){A(n,function(o,i){j(i,n,o,function(a,r,m){let l=parseInt(m.id.substring($.length));te(u,l,parseInt(r.id.substring(8))),b(window.localStorage,u)})})})}function te(e,t,n){return t<n&&(n-=1),e.splice(n,0,e.splice(t,1)[0]),e}function j(e,t,n,o){if(e<Math.hypot(t.target.clientWidth,t.target.clientHeight)){let i=null;for(let a of t.dataTransfer.types)a.startsWith("text/whirlwind_bookmark_id__")&&(i=document.getElementById(a.substring(28)));i.previousElementSibling.id==n.id||i.nextElementSibling.id==n.id||o(t,n,i)}}function A(e,t){let n=null,o=1/0,i=null;for(let a of document.getElementsByClassName("bookmark-divider")){a.classList.add("vhidden");let r=a.getBoundingClientRect(),m=(r.left+r.right)/2,l=(r.top+r.bottom)/2,s=Math.hypot(e.clientX-m,e.clientY-l);s<o&&(o=s,n=a,i=r)}n!==null&&t(n,o,i)}function F(e){return __uv$config.prefix+__uv$config.encodeUrl(e)}function E(e){return __uv$config.decodeUrl(e.split(__uv$config.prefix)[1])}function ne(e,t,n,o){try{let i=e.contentDocument.getElementsByTagName("img")[0],a=document.createElement("canvas");a.width=i.naturalWidth,a.height=i.naturalHeight,a.getContext("2d").drawImage(i,0,0),a.toBlob(function(r){r!==null&&(oe(o,r),P(URL.createObjectURL(r),t,n),window.addEventListener("beforeunload",function(){URL.revokeObjectURL(r)})),e.remove()})}catch(i){console.warn("failed to load favicon (cross platform issue?)"),console.log(i)}}function oe(e,t){ae(t).then(n=>{window.localStorage.setItem(`favicon_cache__${e.favicon_url}`,n)})}function ie(e){let t=null,n=e.getElementsByTagName("link");for(let o of n)(o.getAttribute("rel")=="icon"||o.getAttribute("rel")=="shortcut icon")&&(t=o.getAttribute("href"));return t}function ae(e){return new Promise((t,n)=>{let o=new FileReader;o.onloadend=()=>t(o.result),o.readAsDataURL(e)})}function re(e,t,n){let o=window.localStorage.getItem(`favicon_cache__${e.favicon_url}`);if(o??!1){fetch(o).then(a=>a.blob()).then(a=>{P(URL.createObjectURL(a),t,n),window.addEventListener("beforeunload",function(){URL.revokeObjectURL(a)})});return}let i=document.createElement("iframe");i.src=F(e.favicon_url),i.onload=()=>ne(i,t,n,e),document.getElementById("favicon-loaders").appendChild(i)}function P(e,t,n){t.src=e,t.classList.remove("bookmark-favicon-waiting"),n.removeChild(n.firstChild),n.insertBefore(t,n.firstChild),document.getElementById(n.id).innerHTML=n.innerHTML}function*se(e,t=0){let n=t;for(let o of e)yield[n++,o]}I();B();T();S();})();
//# sourceMappingURL=index.min.js.map
