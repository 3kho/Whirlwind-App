"use strict";(()=>{var y,k=!1;function I(){document.getElementById("uv-frame").addEventListener("load",()=>{k=!0,navbar.classList.add("hidden")}),notch.addEventListener("mouseenter",()=>{k&&(navbar.classList.remove("hidden"),notch.classList.add("no-pointer-events"))}),navbar.addEventListener("mouseenter",()=>{clearTimeout(y)}),navbar.addEventListener("mouseleave",t);function t(){clearTimeout(y),y=setTimeout(()=>{k&&navbar.classList.add("hidden"),notch.classList.remove("no-pointer-events")},500)}document.addEventListener("touchstart",n=>{n.touches[0].clientY<navbar.offsetHeight&&k&&navbar.classList.remove("hidden")})}var N="/uv/sw.js",Y=["localhost","127.0.0.1"];async function _(){if(!navigator.serviceWorker)throw location.protocol!=="https:"&&!Y.includes(location.hostname)?new Error("Service workers cannot be registered without https."):new Error("Your browser doesn't support service workers.");await navigator.serviceWorker.register(N)}function B(e,t,n){let o,a=!1;function i(){a||(a=!0,clearTimeout(o),t.call(this))}function r(){this.readyState==="complete"&&i.call(this)}e.addEventListener("load",function(){i.call(e.contentDocument)});function u(){let s=e.contentDocument;if(s.URL.indexOf("about:")!==0){if(s.readyState==="complete")i.call(s);else if(s.addEventListener("DOMContentLoaded",i),s.addEventListener("readystatechange",r),n){let c=s.defaultView.PerformanceObserver;new c(function(F){F.getEntries().length>0&&i.call(s)}).observe({type:"paint"})}}else o=setTimeout(u,1)}u()}function C(e,t){try{return{url:new URL(e).toString(),was_search:!1}}catch{}try{let n=new URL(`http://${e}`);if(n.hostname.includes("."))return{url:n.toString(),was_search:!1}}catch{}return{url:t.replace("%s",encodeURIComponent(e)),was_search:!0}}function x(){let e=new Date,t=e.getHours(),n=e.getMinutes(),o=e.getSeconds(),a="AM";t==0&&(t=12),t>12&&(t=t-12,a="PM"),t=t<10?"0"+t:t,n=n<10?"0"+n:n,o=o<10?"0"+o:o;let i=t+":"+n+":"+o+" "+a;document.getElementById("clockDisplay").innerText=i,document.getElementById("clockDisplay").textContent=i,setTimeout(x,1e3)}function D(){document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("tabButton"),t=document.getElementById("themeButton"),n=document.getElementById("dropdownContent2"),o=document.getElementById("dropdownColorContent"),a=[{title:"Google Classroom",favicon:"https://ssl.gstatic.com/classroom/favicon.png"},{title:"Google Drive",favicon:"https://ssl.gstatic.com/docs/doclist/images/drive_2022q3_32dp.png"},{title:"Sparx Maths",favicon:"https://sparxmaths.com/favicon.ico"},{title:"Google",favicon:"https://www.google.com/favicon.ico"},{title:"Desmos",favicon:"https://play-lh.googleusercontent.com/AcmdHoyslp6AnrSMvDMg1o3tmhIuy0wbd8mN-usvDzhO4hiTHMLIavweYOPKmlpglrY"}],i=[{title:"Original",colorCode:"#102a43"},{title:"Frapp\xE9",colorCode:"#303446"},{title:"Macchiato",colorCode:"#24273a"},{title:"Mocha",colorCode:"#1e1e2e"},{title:"Red",colorCode:"#d46a6c"},{title:"Yellow",colorCode:"#e9c377"},{title:"Green",colorCode:"#89a35f"},{title:"Purple",colorCode:"#755f91"},{title:"Pink",colorCode:"#a64d99"},{title:"OLED",colorCode:"#000000"},{title:"Dark",colorCode:"#31363F"}];a.forEach(s=>{let c=document.createElement("a");c.href="#";let f=document.createElement("img");f.src=s.favicon,f.alt=s.title,f.classList.add("tab-cloak-icon"),c.appendChild(f),c.classList.add("dropdown-item"),c.insertAdjacentText("beforeend",s.title),c.addEventListener("click",function(){r(s.title,s.favicon)}),n.appendChild(c)}),e.addEventListener("click",function(){n.style.display=n.style.display==="block"?"none":"block"}),t.addEventListener("click",function(){o.style.display=o.style.display==="block"?"none":"block"});function r(s,c){document.title=s;let f=document.getElementById("favicon");f.href=c}function u(s,c){document.body.style.background=c}i.forEach(s=>{let c=document.createElement("a");c.href="#",c.insertAdjacentText("afterbegin",s.title),c.classList.add("dropdown-item"),c.addEventListener("click",function(){u(s.title,s.colorCode)}),o.appendChild(c)})})}function T(){document.getElementById("openPopup").addEventListener("click",function(){document.getElementById("popup").classList.add("show")}),document.getElementById("closePopup").addEventListener("click",function(){let e=document.getElementById("popup");e.style.opacity="0",setTimeout(()=>{e.classList.remove("show"),e.style.opacity=""},300)})}var h=document.getElementById("uv-form"),m=document.getElementById("uv-address"),G=document.getElementById("uv-search-engine"),J=document.getElementById("uv-error"),q=document.getElementById("uv-error-code"),S=new BareMux.BareMuxConnection("/baremux/worker.js"),R=document.getElementById("loader"),l=document.getElementById("uv-frame"),z=document.getElementById("navbar"),K=document.getElementById("notch"),V=document.getElementById("settings"),X=document.getElementById("reload"),Q=document.getElementById("back"),Z=document.getElementById("forward"),p=document.getElementById("proxied-content-wrapper"),M=document.getElementById("omnibox-wrapper"),v=document.getElementById("bookmarks-wrapper"),g=document.getElementById("bookmark-star"),L=document.getElementById("filled-star"),U=!0,O="bookmark_whirlwind_",d;g.addEventListener("click",function(){let e=E(l.contentWindow.location.href),t=ae(l.contentDocument),n=URL.parse(t,e);t===null&&(n=URL.parse(e).origin+"/favicon.ico");let o={favicon_url:n,name:l.contentDocument.title,url:e};d.push(o),w(window.localStorage,d),g.classList.add("none"),L.classList.remove("none")});L.addEventListener("click",function(){let e=[];for(let t of d)t.url==E(l.contentWindow.location.href)&&e.push(t);for(let t of e){let n;(n=d.indexOf(t))!==-1&&d.splice(n,1)}w(window.localStorage,d),g.classList.remove("none"),L.classList.add("none")});h.addEventListener("submit",b);X.addEventListener("click",function(){b(null,E(l.contentDocument.location.href))});Q.addEventListener("click",function(){l.contentWindow.history.back()});Z.addEventListener("click",function(){l.contentWindow.history.forward()});var H=l.contentDocument.location.href,Ee=setInterval(function(){if(H!=l.contentDocument.location.href){m.value=E(l.contentDocument.location.href);let e=!1;for(let t of d)e=e||t.url==m.value;e?(g.classList.add("none"),L.classList.remove("none")):(L.classList.add("none"),g.classList.remove("none")),H=l.contentDocument.location.href,l.contentDocument.addEventListener("dragover",function(t){t.preventDefault()}),l.contentDocument.addEventListener("drop",function(t){t.preventDefault(),b(null,t.dataTransfer.getData("text/plain"))})}},50);async function b(e,t){(e??!1)&&e.preventDefault();let n=h.dataset.isSearchBar==="true";try{await _()}catch(i){throw J.textContent="Failed to register service worker.",q.textContent=i.toString(),i}let o=t??C(m.value,G.value).url,a=(location.protocol==="https:"?"wss":"ws")+"://"+location.host+"/wisp/";await S.getTransport()!=="/epoxy/index.mjs"&&await S.setTransport("/epoxy/index.mjs",[{wisp:a}]),n&&ee(),l.src=$(o),R.classList.contains("none")||B(l,()=>{l.classList.add("loaded-frame"),R.classList.add("none")},!0)}function ee(){p.classList.replace("none","fullscreen"),M.appendChild(h),h.classList.add("omnibox"),h.dataset.isSearchBar="false",K.classList.add("none"),z.classList.add("none"),M.appendChild(V);let e=window.localStorage,t=e.getItem("bookmarksEnabled");t==="true"?p.classList.add("with-bookmarks"):t==="false"?p.classList.remove("with-bookmarks"):(e.setItem("bookmarksEnabled",U),U?p.classList.add("with-bookmarks"):p.classList.remove("with-bookmarks")),w(e),g.classList.remove("none")}m.addEventListener("drop",function(e){e.preventDefault(),m.value=e.dataTransfer.getData("text/plain")});m.addEventListener("dragover",function(e){e.preventDefault()});m.addEventListener("dragenter",function(e){e.preventDefault(),m.select()});m.addEventListener("dragleave",function(e){e.preventDefault(),document.getSelection().removeAllRanges()});function A(e){return`<span class="bookmark-divider vhidden" id="divider_${e}"><svg id="chart" width="0.25rem" height="2rem"><line x1="0" y1="0" x2="0" y2="32" class="vertical-bar"></line></svg></span>`}function w(e,t){e.getItem("bookmarks")===null&&e.setItem("bookmarks","[]"),(t??!1)&&e.setItem("bookmarks",JSON.stringify(t)),d=JSON.parse(e.getItem("bookmarks")),v.innerHTML=A(0);for(let[n,o]of se(d)){let a=document.createElement("span");a.classList.add("bookmark"),a.draggable=!0;let i=document.createElement("img");i.alt="bookmark favicon",i.classList.add("bookmark-favicon"),i.classList.add("bookmark-favicon-waiting"),i.draggable=!1,a.appendChild(i),a.insertAdjacentText("beforeend",o.name),a.dataset.url=o.url,a.id=`${O}${n}`,a.addEventListener("dragstart",function(r){r.currentTarget.classList.add("dragging"),r.dataTransfer.clearData(),r.dataTransfer.setData("text/plain",r.target.dataset.url),r.dataTransfer.setData("text/id",r.target.id),r.dataTransfer.setData(`text/whirlwind_bookmark_id__${r.target.id}`,"")}),a.addEventListener("dragend",function(r){r.currentTarget.classList.remove("dragging")}),re(o,i,a),v.appendChild(a),v.insertAdjacentHTML("beforeend",A(n+1)),a.onclick=()=>b(null,a.dataset.url)}v.addEventListener("dragover",function(n){n.preventDefault(),W(n,function(o,a,i){j(a,n,o,()=>o.classList.remove("vhidden"))})}),v.addEventListener("dragleave",function(n){for(let o of document.getElementsByClassName("bookmark-divider"))o.classList.add("vhidden")}),v.addEventListener("drop",function(n){W(n,function(o,a){j(a,n,o,function(i,r,u){let s=parseInt(u.id.substring(O.length));te(d,s,parseInt(r.id.substring(8))),w(window.localStorage,d)})})})}function te(e,t,n){return t<n&&(n-=1),e.splice(n,0,e.splice(t,1)[0]),e}function j(e,t,n,o){if(e<Math.hypot(t.target.clientWidth,t.target.clientHeight)){let a=null;for(let i of t.dataTransfer.types)i.startsWith("text/whirlwind_bookmark_id__")&&(a=document.getElementById(i.substring(28)));a.previousElementSibling.id==n.id||a.nextElementSibling.id==n.id||o(t,n,a)}}function W(e,t){let n=null,o=1/0,a=null;for(let i of document.getElementsByClassName("bookmark-divider")){i.classList.add("vhidden");let r=i.getBoundingClientRect(),u=(r.left+r.right)/2,s=(r.top+r.bottom)/2,c=Math.hypot(e.clientX-u,e.clientY-s);c<o&&(o=c,n=i,a=r)}n!==null&&t(n,o,a)}function $(e){return __uv$config.prefix+__uv$config.encodeUrl(e)}function E(e){return __uv$config.decodeUrl(e.split(__uv$config.prefix)[1])}function ne(e,t,n,o){try{let a=e.contentDocument.getElementsByTagName("img")[0],i=document.createElement("canvas");i.width=a.naturalWidth,i.height=a.naturalHeight,i.getContext("2d").drawImage(a,0,0),i.toBlob(function(r){r!==null&&(oe(o,r),P(URL.createObjectURL(r),t,n),window.addEventListener("beforeunload",function(){URL.revokeObjectURL(r)})),e.remove()})}catch(a){console.warn("failed to load favicon (cross platform issue?)"),console.log(a)}}function oe(e,t){ie(t).then(n=>{window.localStorage.setItem(`favicon_cache__${e.favicon_url}`,n)})}function ae(e){let t=null,n=e.getElementsByTagName("link");for(let o of n)(o.getAttribute("rel")=="icon"||o.getAttribute("rel")=="shortcut icon")&&(t=o.getAttribute("href"));return t}function ie(e){return new Promise((t,n)=>{let o=new FileReader;o.onloadend=()=>t(o.result),o.readAsDataURL(e)})}function re(e,t,n){let o=window.localStorage.getItem(`favicon_cache__${e.favicon_url}`);if(o??!1){fetch(o).then(i=>i.blob()).then(i=>{P(URL.createObjectURL(i),t,n),window.addEventListener("beforeunload",function(){URL.revokeObjectURL(i)})});return}let a=document.createElement("iframe");a.src=$(e.favicon_url),a.onload=()=>ne(a,t,n,e),document.getElementById("favicon-loaders").appendChild(a)}function P(e,t,n){t.src=e,t.classList.remove("bookmark-favicon-waiting"),n.removeChild(n.firstChild),n.insertBefore(t,n.firstChild),document.getElementById(n.id).innerHTML=n.innerHTML}function*se(e,t=0){let n=t;for(let o of e)yield[n++,o]}I();x();D();T();})();
//# sourceMappingURL=index.min.js.map
