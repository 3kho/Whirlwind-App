"use strict";(()=>{var E,L=!1;function B(){document.getElementById("uv-frame").addEventListener("load",()=>{L=!0,navbar.classList.add("hidden")}),notch.addEventListener("mouseenter",()=>{L&&(navbar.classList.remove("hidden"),notch.classList.add("no-pointer-events"))}),navbar.addEventListener("mouseenter",()=>{clearTimeout(E)}),navbar.addEventListener("mouseleave",t);function t(){clearTimeout(E),E=setTimeout(()=>{L&&navbar.classList.add("hidden"),notch.classList.remove("no-pointer-events")},500)}document.addEventListener("touchstart",n=>{n.touches[0].clientY<navbar.offsetHeight&&L&&navbar.classList.remove("hidden")})}var N="/uv/sw.js",G=["localhost","127.0.0.1"];async function I(){if(!navigator.serviceWorker)throw location.protocol!=="https:"&&!G.includes(location.hostname)?new Error("Service workers cannot be registered without https."):new Error("Your browser doesn't support service workers.");await navigator.serviceWorker.register(N)}function x(e,t,n){let o,i=!1;function a(){i||(i=!0,clearTimeout(o),t.call(this))}function r(){this.readyState==="complete"&&a.call(this)}e.addEventListener("load",function(){a.call(e.contentDocument)});function m(){let s=e.contentDocument;if(s.URL.indexOf("about:")!==0){if(s.readyState==="complete")a.call(s);else if(s.addEventListener("DOMContentLoaded",a),s.addEventListener("readystatechange",r),n){let c=s.defaultView.PerformanceObserver;new c(function(P){P.getEntries().length>0&&a.call(s)}).observe({type:"paint"})}}else o=setTimeout(m,1)}m()}function C(e,t){try{return{url:new URL(e).toString(),was_search:!1}}catch{}try{let n=new URL(`http://${e}`);if(n.hostname.includes("."))return{url:n.toString(),was_search:!1}}catch{}return{url:t.replace("%s",encodeURIComponent(e)),was_search:!0}}function y(){let e=new Date,t=e.getHours(),n=e.getMinutes(),o=e.getSeconds(),i="AM";t==0&&(t=12),t>12&&(t=t-12,i="PM"),t=t<10?"0"+t:t,n=n<10?"0"+n:n,o=o<10?"0"+o:o;let a=t+":"+n+":"+o+" "+i;document.getElementById("clockDisplay").innerText=a,document.getElementById("clockDisplay").textContent=a,setTimeout(y,1e3)}function D(){document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("tabButton"),t=document.getElementById("themeButton"),n=document.getElementById("dropdownContent2"),o=document.getElementById("dropdownColorContent"),i=[{title:"Google Classroom",favicon:"https://ssl.gstatic.com/classroom/favicon.png"},{title:"Google Drive",favicon:"https://ssl.gstatic.com/docs/doclist/images/drive_2022q3_32dp.png"},{title:"Google Docs",favicon:"https://ssl.gstatic.com/docs/doclist/images/drive_2022q3_32dp.png"},{title:"Google",favicon:"https://www.google.com/favicon.ico"}],a=[{title:"Original",colorCode:"#102a43"},{title:"Frapp\xE9",colorCode:"#303446"},{title:"Macchiato",colorCode:"#24273a"},{title:"Mocha",colorCode:"#1e1e2e"},{title:"Red",colorCode:"#d46a6c"},{title:"Yellow",colorCode:"#e9c377"},{title:"Green",colorCode:"#89a35f"},{title:"Purple",colorCode:"#755f91"},{title:"Pink",colorCode:"#a64d99"},{title:"OLED",colorCode:"#000000"},{title:"Dark",colorCode:"#31363F"}];i.forEach(s=>{let c=document.createElement("a");c.href="#",c.innerHTML=`<img src="${s.favicon}" alt="${s.title}"> ${s.title}`,c.addEventListener("click",function(){r(s.title,s.favicon)}),n.appendChild(c)}),e.addEventListener("click",function(){n.style.display=n.style.display==="block"?"none":"block"}),t.addEventListener("click",function(){o.style.display=o.style.display==="block"?"none":"block"});function r(s,c){document.title=s;let _=document.getElementById("favicon");_.href=c}function m(s,c){console.log("fired"),document.body.style.background=c}a.forEach(s=>{let c=document.createElement("a");c.href="#",c.innerHTML=`${s.title}`,c.addEventListener("click",function(){m(s.title,s.colorCode)}),o.appendChild(c)})})}function T(){document.getElementById("openPopup").addEventListener("click",function(){document.getElementById("popup").classList.add("show")}),document.getElementById("closePopup").addEventListener("click",function(){let e=document.getElementById("popup");e.style.opacity="0",setTimeout(()=>{e.classList.remove("show"),e.style.opacity=""},300)})}var p=document.getElementById("uv-form"),u=document.getElementById("uv-address"),Y=document.getElementById("uv-search-engine"),q=document.getElementById("uv-error"),J=document.getElementById("uv-error-code"),S=new BareMux.BareMuxConnection("/baremux/worker.js"),R=document.getElementById("loader"),d=document.getElementById("uv-frame"),V=document.getElementById("navbar"),X=document.getElementById("notch"),z=document.getElementById("settings"),K=document.getElementById("reload"),Q=document.getElementById("back"),Z=document.getElementById("forward"),g=document.getElementById("proxied-content-wrapper"),U=document.getElementById("omnibox-wrapper"),f=document.getElementById("bookmarks-wrapper"),v=document.getElementById("bookmark-star"),h=document.getElementById("filled-star"),M=!0,O="bookmark_whirlwind_",l;v.addEventListener("click",function(){let e=w(d.contentWindow.location.href),t=ie(d.contentDocument),n=URL.parse(t,e);t===null&&(n=URL.parse(e).origin+"/favicon.ico");let o={favicon_url:n,name:d.contentDocument.title,url:e};l.push(o),b(window.localStorage,l),v.classList.add("none"),h.classList.remove("none")});h.addEventListener("click",function(){let e=[];for(let t of l)t.url==w(d.contentWindow.location.href)&&e.push(t);for(let t of e){let n;(n=l.indexOf(t))!==-1&&l.splice(n,1)}b(window.localStorage,l),v.classList.remove("none"),h.classList.add("none")});p.addEventListener("submit",k);K.addEventListener("click",function(){k(null,w(d.contentDocument.location.href))});Q.addEventListener("click",function(){d.contentWindow.history.back()});Z.addEventListener("click",function(){d.contentWindow.history.forward()});var $=d.contentDocument.location.href,Ee=setInterval(function(){if($!=d.contentDocument.location.href){u.value=w(d.contentDocument.location.href);let e=!1;for(let t of l)e=e||t.url==u.value;e?(v.classList.add("none"),h.classList.remove("none")):(h.classList.add("none"),v.classList.remove("none")),$=d.contentDocument.location.href,d.contentDocument.addEventListener("dragover",function(t){t.preventDefault()}),d.contentDocument.addEventListener("drop",function(t){t.preventDefault(),k(null,t.dataTransfer.getData("text/plain"))})}},50);async function k(e,t){(e??!1)&&e.preventDefault();let n=p.dataset.isSearchBar==="true";try{await I()}catch(a){throw q.textContent="Failed to register service worker.",J.textContent=a.toString(),a}let o=t??C(u.value,Y.value).url,i=(location.protocol==="https:"?"wss":"ws")+"://"+location.host+"/wisp/";await S.getTransport()!=="/epoxy/index.mjs"&&await S.setTransport("/epoxy/index.mjs",[{wisp:i}]),n&&ee(),d.src=A(o),R.classList.contains("none")||x(d,()=>{d.classList.add("loaded-frame"),R.classList.add("none")},!0)}function ee(){g.classList.replace("none","fullscreen"),U.appendChild(p),p.classList.add("omnibox"),p.dataset.isSearchBar="false",X.classList.add("none"),V.classList.add("none"),U.appendChild(z);let e=window.localStorage,t=e.getItem("bookmarksEnabled");t==="true"?g.classList.add("with-bookmarks"):t==="false"?g.classList.remove("with-bookmarks"):(e.setItem("bookmarksEnabled",M),M?g.classList.add("with-bookmarks"):g.classList.remove("with-bookmarks")),b(e),v.classList.remove("none")}u.addEventListener("drop",function(e){e.preventDefault(),u.value=e.dataTransfer.getData("text/plain")});u.addEventListener("dragover",function(e){e.preventDefault()});u.addEventListener("dragenter",function(e){e.preventDefault(),u.select()});u.addEventListener("dragleave",function(e){e.preventDefault(),document.getSelection().removeAllRanges()});function H(e){return`<span class="bookmark-divider vhidden" id="divider_${e}"><svg id="chart" width="0.25rem" height="2rem"><line x1="0" y1="0" x2="0" y2="32" class="vertical-bar"></line></svg></span>`}function b(e,t){e.getItem("bookmarks")===null&&e.setItem("bookmarks","[]"),(t??!1)&&e.setItem("bookmarks",JSON.stringify(t)),l=JSON.parse(e.getItem("bookmarks")),f.innerHTML=H(0);for(let[n,o]of se(l)){let i=document.createElement("span");i.classList.add("bookmark"),i.draggable=!0;let a=document.createElement("img");a.alt="bookmark favicon",a.classList.add("bookmark-favicon"),a.classList.add("bookmark-favicon-waiting"),a.draggable=!1,i.appendChild(a),i.insertAdjacentText("beforeend",o.name),i.dataset.url=o.url,i.id=`${O}${n}`,i.addEventListener("dragstart",function(r){r.currentTarget.classList.add("dragging"),r.dataTransfer.clearData(),r.dataTransfer.setData("text/plain",r.target.dataset.url),r.dataTransfer.setData("text/id",r.target.id),r.dataTransfer.setData(`text/whirlwind_bookmark_id__${r.target.id}`,"")}),i.addEventListener("dragend",function(r){r.currentTarget.classList.remove("dragging")}),re(o,a,i),f.appendChild(i),f.insertAdjacentHTML("beforeend",H(n+1)),i.onclick=()=>k(null,i.dataset.url)}f.addEventListener("dragover",function(n){n.preventDefault(),j(n,function(o,i,a){W(i,n,o,()=>o.classList.remove("vhidden"))})}),f.addEventListener("dragleave",function(n){for(let o of document.getElementsByClassName("bookmark-divider"))o.classList.add("vhidden")}),f.addEventListener("drop",function(n){j(n,function(o,i){W(i,n,o,function(a,r,m){let s=parseInt(m.id.substring(O.length));te(l,s,parseInt(r.id.substring(8))),b(window.localStorage,l)})})})}function te(e,t,n){return t<n&&(n-=1),e.splice(n,0,e.splice(t,1)[0]),e}function W(e,t,n,o){if(e<Math.hypot(t.target.clientWidth,t.target.clientHeight)){let i=null;for(let a of t.dataTransfer.types)a.startsWith("text/whirlwind_bookmark_id__")&&(i=document.getElementById(a.substring(28)));i.previousElementSibling.id==n.id||i.nextElementSibling.id==n.id||o(t,n,i)}}function j(e,t){let n=null,o=1/0,i=null;for(let a of document.getElementsByClassName("bookmark-divider")){a.classList.add("vhidden");let r=a.getBoundingClientRect(),m=(r.left+r.right)/2,s=(r.top+r.bottom)/2,c=Math.hypot(e.clientX-m,e.clientY-s);c<o&&(o=c,n=a,i=r)}n!==null&&t(n,o,i)}function A(e){return __uv$config.prefix+__uv$config.encodeUrl(e)}function w(e){return __uv$config.decodeUrl(e.split(__uv$config.prefix)[1])}function ne(e,t,n,o){try{let i=e.contentDocument.getElementsByTagName("img")[0],a=document.createElement("canvas");a.width=i.naturalWidth,a.height=i.naturalHeight,a.getContext("2d").drawImage(i,0,0),a.toBlob(function(r){r!==null&&(oe(o,r),F(URL.createObjectURL(r),t,n),window.addEventListener("beforeunload",function(){URL.revokeObjectURL(r)})),e.remove()})}catch(i){console.warn("failed to load favicon (cross platform issue?)"),console.log(i)}}function oe(e,t){ae(t).then(n=>{window.localStorage.setItem(`favicon_cache__${e.favicon_url}`,n)})}function ie(e){let t=null,n=e.getElementsByTagName("link");for(let o of n)(o.getAttribute("rel")=="icon"||o.getAttribute("rel")=="shortcut icon")&&(t=o.getAttribute("href"));return t}function ae(e){return new Promise((t,n)=>{let o=new FileReader;o.onloadend=()=>t(o.result),o.readAsDataURL(e)})}function re(e,t,n){let o=window.localStorage.getItem(`favicon_cache__${e.favicon_url}`);if(o??!1){fetch(o).then(a=>a.blob()).then(a=>{F(URL.createObjectURL(a),t,n),window.addEventListener("beforeunload",function(){URL.revokeObjectURL(a)})});return}let i=document.createElement("iframe");i.src=A(e.favicon_url),i.onload=()=>ne(i,t,n,e),document.getElementById("favicon-loaders").appendChild(i)}function F(e,t,n){t.src=e,t.classList.remove("bookmark-favicon-waiting"),n.removeChild(n.firstChild),n.insertBefore(t,n.firstChild),document.getElementById(n.id).innerHTML=n.innerHTML}function*se(e,t=0){let n=t;for(let o of e)yield[n++,o]}B();y();D();T();})();
//# sourceMappingURL=index.min.js.map
